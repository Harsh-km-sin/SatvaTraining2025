<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        .signature-pad {
            border: 1px solid #ddd;
            border-radius: 5px;
            height: 200px;
            width: 100%;
        }

        .ssn-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            margin-right: 35px;
            border-radius: 5px;
        }

        .ssn-input:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 5px rgba(13, 110, 253, 0.5);
        }

        small {
            color: rgb(126, 126, 126);
        }

        .form-check {
            margin-top: 20px;
        }

        .ssn-input.is-valid {
            padding-right: 10px;
            background-image: none;
            border-color: green !important;
            color: black;
        }

        .ssn-input.is-invalid {
            padding-right: 10px;
            background-image: none;
            border-color: red !important;
            color: black;
        }


        .ssn-input.is-valid {
            padding-right: 10px;
            background-image: none;
            border-color: green !important;
            color: black;
        }

        .ssn-input.is-invalid {
            padding-right: 10px;
            background-image: none;
            border-color: red !important;
            color: black;
        }

        .ssn-input.is-invalid+.invalid-feedback {
            display: none;
        }

        .ssn-input.is-valid {
            border-color: green !important;
            color: black;
        }

        .ssn-input.is-invalid {
            border-color: red !important;
            color: black;
        }

        .ssn-input:focus.is-valid {
            border-color: green !important;
        }

        .ssn-input:focus.is-invalid {
            border-color: red !important;
        }

        .no-arrows::-webkit-inner-spin-button,
        .no-arrows::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .no-arrows {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
    </style>
</head>

<body>
    <div class="container col-md=8 bg-light border rounded mt-3">
        <div class="p-3 mt-5 border-bottom">
            <h1>Request for Taxpayer Identification <br> Number and Certification</h1>
            <p class="fs-5">Go to www.irs.gov/FormW9 for instructions and the latest information.</p>
        </div>

        <div class="p-3">
            <form id="signatureForm" class="p-3">
                <div class="my-3">
                    <label for="entityName">
                        1. Name of entity/individual. An entry is required. (For a sole proprietor or disregarded
                        entity, enter the owner’s name on line 1, and enter the business/disregarded entity’s name on
                        line 2.)
                    </label>
                    <input type="text" name="entityName" id="entityName" class="form-control w-50 mt-2" required>
                </div>

                <div class="my-3">
                    <label for="businessName">
                        2. Business name/disregarded entity name, if different from above.
                    </label>
                    <input type="text" name="businessName" id="businessName" class="form-control w-50 mt-2" required>
                </div>

                <div class="my-3">
                    <label for="taxClassification" class="form-label">
                        3. Check the appropriate box for federal tax classification of the entity/individual whose name
                        is entered on line 1. Check only one of the following seven boxes.
                    </label>
                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="individual" class="form-check-input">
                        <label for="individual" class="form-check-label">Individual/sole proprietor</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="cCorporation" class="form-check-input">
                        <label for="cCorporation" class="form-check-label">C Corporation</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="sCorporation" class="form-check-input">
                        <label for="sCorporation" class="form-check-label">S Corporation</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="partnership" class="form-check-input">
                        <label for="partnership" class="form-check-label">Partnership</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="trustEstate" class="form-check-input">
                        <label for="trustEstate" class="form-check-label">Trust/estate</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="llc" class="form-check-input">
                        <label for="llc" class="form-check-label">Limited liability company</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" name="taxClassification" id="other" class="form-check-input">
                        <label for="other" class="form-check-label">Other</label>
                    </div>
                </div>

                <div class="my-3">
                    <label for="llcTaxClassification">
                        If you selected "Limited liability company", enter the tax classification (C=C corporation, S=S
                        corporation, P=Partnership)
                    </label>
                    <input type="text" name="llcTaxClassification" id="llcTaxClassification"
                        class="form-control w-50 mt-2">
                </div>

                <div class="my-3">
                    <label for="foreignPartners">
                        3b. If on line 3a you checked “Partnership” or “Trust/estate,” or checked “LLC” and entered “P”
                        as its tax classification, and you are providing this form to a partnership, trust, or estate in
                        which you have an ownership interest, check this box if you have any foreign partners, owners,
                        or beneficiaries.
                    </label>
                    <div class="form-check">
                        <input type="checkbox" name="foreignPartners" id="foreignPartnersCheck"
                            class="form-check-input">
                        <label for="foreignPartnersCheck" class="form-check-label">Check Here</label>
                    </div>
                </div>

                <div class="my-5">
                    <p>4. Exemptions (codes apply only to certain entities, not individuals; see instructions on page
                        3):</p>
                </div>

                <div class="my-3">
                    <label for="exemptPayeeCode">
                        Exempt payee code (if any)
                    </label>
                    <input type="text" name="exemptPayeeCode" id="exemptPayeeCode" class="form-control w-50 mt-2">
                </div>

                <div class="my-3">
                    <label for="fatcaExemptionCode">
                        Exemption from Foreign Account Tax Compliance Act (FATCA) reporting code (if any)
                    </label>
                    <input type="text" name="fatcaExemptionCode" id="fatcaExemptionCode" class="form-control w-50 mt-2">
                </div>

                <div class="my-3">
                    <label for="address">
                        5-6. Address (number, street, and apt. or suite no.)
                    </label>
                    <input type="text" name="address" id="address" class="form-control w-50 mt-2">
                    <small>Number, Street, and Apt. or Suite No.</small>

                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" name="city" id="city" class="form-control mt-2">
                            <small>City</small>
                        </div>

                        <div class="col-md-6">
                            <input type="text" name="state" id="state" class="form-control mt-2">
                            <small>State</small>
                        </div>
                    </div>

                    <input type="text" name="zipCode" id="zipCode" class="form-control mt-2">
                    <small>Zip Code</small>
                </div>

                <div class="my-3">
                    <p>Requester's name</p>
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" name="requesterFirstName" id="requesterFirstName"
                                class="form-control mt-2">
                            <small>First Name</small>
                        </div>

                        <div class="col-md-6">
                            <input type="text" name="requesterLastName" id="requesterLastName"
                                class="form-control mt-2">
                            <small>Last Name</small>
                        </div>
                    </div>
                </div>

                <div class="my-3">
                    <p>Requester's address</p>
                    <input type="text" name="requesterAddress" id="requesterAddress" class="form-control w-50 mt-2">
                    <small>Number, Street, and Apt. or Suite No.</small>
                    <div class="row">
                        <div class="col-md-6">
                            <input type="text" name="requesterCity" id="requesterCity" class="form-control mt-2">
                            <small>City</small>
                        </div>

                        <div class="col-md-6">
                            <input type="text" name="requesterState" id="requesterState" class="form-control mt-2">
                            <small>State</small>
                        </div>
                    </div>
                </div>

                <div class="my-3">
                    <label for="accountNumbers">
                        7. List account number(s) here (optional)
                    </label>
                    <input type="text" name="accountNumbers" id="accountNumbers" class="form-control w-50 mt-2">
                </div>

                <div class="my-5">
                    <h3>Part I - Taxpayer Identification Number (TIN)</h3>
                    <hr>

                    <div class="my-5">
                        Enter your TIN in the appropriate box. The TIN provided must match the name given on line 1 to
                        avoid backup withholding. For individuals, this is generally your social security number (SSN).
                        However, for a resident alien, sole proprietor, or disregarded entity, see the instructions for
                        Part I, later. For other entities, it is your employer identification number (EIN). If you do
                        not have a number, see How to get a TIN, later.
                    </div>

                    <div class="mt-2">
                        <b>Note:</b> If the account is in more than one name, see the instructions for line 1. Also see
                        What Name and Number To Give the Requester for guidelines on whose number to enter.
                    </div>
                </div>

                <div class="my-5">
                    <h3>Social Security Number</h3>
                    <hr>
                    <div class="d-flex flex-wrap justify-content-center mt-5">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn1">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn2">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn3">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn4">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn5">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn6">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn7">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn8">
                        <input type="text" maxlength="1" class="form-control ssn-input col-4 col-md-1" name="ssn9">
                    </div>
                </div>

                <div class="my-5">
                    <h3>OR</h3>
                    <hr>
                    <h3 class="mt-5">Employer identification number</h3>
                    <hr>
                    <div class="d-flex flex-wrap justify-content-center mt-5">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein1">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein2">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein3">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein4">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein5">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein6">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein7">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein8">
                        <input type="number" maxlength="1" class="form-control ssn-input col-4 col-md-1 no-arrows"
                            name="ein9">
                    </div>
                </div>


                <div class="my-3">
                    <h4>Part II - Certification</h4>
                    <hr>

                    <div class="mt-4">
                        <p>Under penalties of perjury, I certify that:</p>
                        <p>1. The number shown on this form is my correct taxpayer identification number (or I am
                            waiting for a number to be issued to me); and</p>

                        <p>2. I am not subject to backup withholding because: (a) I am exempt from backup withholding,
                            or (b) I have not been notified by the Internal Revenue Service (IRS) that I am subject to
                            backup withholding as a result of a failure to report all interest or dividends, or (c) the
                            IRS has notified me that I am no longer subject to backup withholding; and</p>
                        <p>3. I am a U.S. citizen or other U.S. person (defined below); and</p>

                        <p>4. The FATCA code(s) entered on this form (if any) indicating that I am exempt from FATCA
                            reporting is correct.</p>

                        <p><b>Certification instructions.</b>You must cross out item 2 above if you have been notified
                            by the IRS that you are currently subject to backup withholding because you have failed to
                            report all interest and dividends on your tax return. For real estate transactions, item 2
                            does not apply. For mortgage interest paid, acquisition or abandonment of secured property,
                            cancellation of debt, contributions to an individual retirement arrangement (IRA), and
                            generally, payments other than interest and dividends, you are not required to sign the
                            certification, but you must provide your correct TIN. See the instructions for Part II,
                            later.</p>
                    </div>
                </div>

                <div class="my-5">
                    <h5>Signature</h5>
                    <canvas id="sign-pad" class="signature-pad"></canvas>
                    <button type="button" id="clear" class="btn btn-secondary">Clear</button>
                </div>

                <div class="my-5">
                    <h5>Date</h5>
                    <input type="date" class="form-control w-25" name="submissionDate" id="submissionDate">
                    <small>Date</small>
                </div>

                <hr>
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-secondary px-5" id="preview-btn">Preview PDF</button>
                    <button class="btn btn-success px-5" id="submit-btn">Submit</button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
    <script src="./script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const canvas = document.getElementById("sign-pad");
            const signaturePad = new SignaturePad(canvas);
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear();
            }
            window.addEventListener("resize", resizeCanvas);
            resizeCanvas();
            document.getElementById("clear").addEventListener("click", () => {
                signaturePad.clear();
            });

            const previewBtn = document.getElementById("preview-btn");
            const form = document.getElementById("signatureForm");
            const signPad = document.getElementById("sign-pad");

            function getFormData() {
                const formData = new FormData(form);
                const data = {};

                formData.forEach((value, key) => {
                    data[key] = value;
                });

                const signatureImage = signPad.toDataURL();
                data.signature = signatureImage;

                return data;
            }

            function generatePDF(data) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                let yOffset = 10;

                doc.text(`1. Name of Entity/Individual: ${data.entityName}`, 10, yOffset);
                yOffset += 10;
                doc.text(`2. Business Name: ${data.businessName}`, 10, yOffset);
                yOffset += 10;
                doc.text(`3. Tax Classification: ${data.taxClassification}`, 10, yOffset);
                yOffset += 10;
                if (data.llcTaxClassification) {
                    doc.text(
                        `LLC Tax Classification: ${data.llcTaxClassification}`,
                        10,
                        yOffset
                    );
                    yOffset += 10;
                }
                doc.text(`Exempt Payee Code: ${data.exemptPayeeCode}`, 10, yOffset);
                yOffset += 10;
                doc.text(`FATCA Exemption Code: ${data.fatcaExemptionCode}`, 10, yOffset);
                yOffset += 10;

                doc.text(
                    `5-6. Address: ${data.address}, ${data.city}, ${data.state}, ${data.zipCode}`,
                    10,
                    yOffset
                );
                yOffset += 10;

                doc.text(
                    `Requester's Name: ${data.requesterFirstName} ${data.requesterLastName}`,
                    10,
                    yOffset
                );
                yOffset += 10;
                doc.text(
                    `Requester's Address: ${data.requesterAddress}, ${data.requesterCity}, ${data.requesterState}`,
                    10,
                    yOffset
                );
                yOffset += 10;

                doc.text(
                    `SSN: ${data.ssn1}${data.ssn2}${data.ssn3}-${data.ssn4}${data.ssn5}${data.ssn6}-${data.ssn7}${data.ssn8}${data.ssn9}`,
                    10,
                    yOffset
                );
                yOffset += 10;

                doc.text(
                    `EIN: ${data.ein1}${data.ein2}${data.ein3}-${data.ein4}${data.ein5}${data.ein6}-${data.ein7}${data.ein8}${data.ein9}`,
                    10,
                    yOffset
                );
                yOffset += 10;

                // Add Signature Image (Base64)
                if (data.signature) {
                    doc.addImage(data.signature, "PNG", 10, yOffset, 50, 30);
                    yOffset += 35;
                }

                doc.text(`Date: ${data.submissionDate}`, 10, yOffset);

                doc.save("formPreview.pdf");
            }

            previewBtn.addEventListener("click", (event) => {
                event.preventDefault();

                const formData = getFormData();

                generatePDF(formData);
            });
        });

        $(document).ready(function () {
            function validateInput(inputElement) {
                const pattern = inputElement.getAttribute("pattern");
                const isRequired = inputElement.hasAttribute("required");
                const value = inputElement.value.trim();

                if (isRequired && value === "") {
                    inputElement.classList.remove("is-valid");
                    inputElement.classList.add("is-invalid");
                    return false;
                }

                if (pattern && !new RegExp(pattern).test(value)) {
                    inputElement.classList.remove("is-valid");
                    inputElement.classList.add("is-invalid");
                    return false;
                }

                inputElement.classList.remove("is-invalid");
                inputElement.classList.add("is-valid");
                return true;
            }

            $("#signatureForm").on("submit", function (event) {
                event.preventDefault();
                let isValid = true;

                $("#signatureForm input").each(function () {
                    if (!validateInput(this)) {
                        isValid = false;
                    }
                });

                if (isValid) {
                    alert("Form is valid! Form Submitted");
                    document.getElementById("signatureForm").reset();
                } else {
                    alert("Please fix the errors in the form.");
                }
            });

            $("#signatureForm input").on("focusout", function () {
                validateInput(this);
            });

            $('#signatureForm input[name="ssn1"], #signatureForm input[name="ein1"]').on(
                "input",
                function () {
                    validateInput(this);
                }
            );

            $("#submit-btn").click(function () {
                $("#buttonForm")[0].reset();
                $("#signatureForm input").removeClass("is-valid is-invalid");
            });
        });

    </script>
</body>

</html>